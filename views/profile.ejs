<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="/styles/base.css">
    <link rel="stylesheet" href="/styles/profile.css">
    <script src="/scripts/likeBtn.js" defer></script>
    <script src="/scripts/likeComment.js" defer></script>
    <script src="/scripts/profileTab.js" defer></script>
</head>
<body>
    <%- include('nav', { page: (user.id === userData.id) ? 'user' : '' }) %>
    <main>
        <div class="main-header">
            <div class="non-switch">
                <p><%= (user.id === userData.id) ? 'Profile' : userData.username %></p>
            </div>
        </div>
        <div class="main-content">
            <div class="profile">
                <div class="profile-name">
                    <h2><%= userData.firstName %> <%= userData.lastName %></h2>
                    <p><%= userData.username %></p>
                </div>
                <div class="profile-avatar">
                    <img src="<%= gravatarUrl(userData.gravatar, 84) %>" alt="">
                </div>
            </div>
            <div class="bio">
                <p><%= userData.bio %></p>
            </div>
            <div class="profile-links">
                <div class="followers">
                    <p><%= userData.followers.length %> followers</p>
                </div>
            </div>
            <div class="profile-menu">
                <% if (user.id === userData.id) { %>
                    <button class="edit-profile">Edit profile</button>
                <% } else if (relationship?.status === 'PENDING') { %>
                    <div class="req-pending">Follow Requested</div>
                <% } else if (relationship?.status === 'ACCEPTED') { %>
                    <form action="/unfollow" method="POST">
                        <input type="hidden" name="followingId" value="<%= userData.id %>">
                        <button class="unfollow">Unfollow</button>
                    </form>
                <% } else { %>
                    <form action="/follow" method="POST">
                        <input type="hidden" name="followingId" value="<%= userData.id %>">
                        <button class="follow-btn">Follow</button>
                    </form>
                <% } %>
            </div>
            <div class="profile-tabs">
                <button id="threads-tab" class="active-tab"><span class="tab-label">Threads</span></button>
                <button id="replies-tab"><span class="tab-label">Replies</span></button>
                <% if (user.id === userData.id) { %>
                    <button id="saved-tab"><span class="tab-label">Saved</span></button>
                <% } %>
            </div>
            <div class="posts-container">
                <% if (user.id === userData.id) { %>
                    <div class="new-post-block">
                        <div class="avatar">
                            <img src="<%= gravatarUrl(user.gravatar) %>" alt="avatar" />
                        </div>
                        <input type="text" id="trigger-input" placeholder="What's new?" />
                        <button class="post-btn">Post</button>
                    </div>
                <% } else { %> 
                    <div class="spacer"></div> 
                <% } %>
                <div class="threads-container">
                    <% userData.posts.forEach((post) => { %>
                        <%- include('partials/postBlock', { post }) %>
                    <% }) %>
                </div>
                <div class="replies-container">
                    <% userData.comments.forEach((comment) => { %>
                        <%- include('partials/postComment', { comment }) %>
                    <% }) %>
                </div>
            </div>
        </div>
    </main>
</body>
</html>